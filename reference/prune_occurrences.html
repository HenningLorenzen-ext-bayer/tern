<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Occurrence Table Pruning — prune_occurrences • tern</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Occurrence Table Pruning — prune_occurrences"><meta property="og:description" content="Family of constructor and condition functions to flexibly prune occurrence tables.
The condition functions always return whether the row result is higher than the threshold.
Since they are of class CombinationFunction() they can be logically combined with other condition
functions."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-125641273-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125641273-1');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tern</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.7.5.9016</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/introduction.html">Introduction to tern</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<!-- start_releases -->
<li class="dropdown">
	<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
Other releases
<span class="caret"></span></a><ul class="dropdown-menu" role="menu">
   <li><a href="../index.html">latest</a></li>
   <li><a href="..//index.html"></a></li>
</ul></li>
<!-- end_releases -->
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/insightsengineering/tern" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Occurrence Table Pruning</h1>
    <small class="dont-index">Source: <a href="https://github..com/insightsengineering/tern/blob/HEAD/R/prune_occurrences.R" class="external-link"><code>R/prune_occurrences.R</code></a></small>
    <div class="hidden name"><code>prune_occurrences.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Family of constructor and condition functions to flexibly prune occurrence tables.
The condition functions always return whether the row result is higher than the threshold.
Since they are of class <code><a href="combination_function.html">CombinationFunction()</a></code> they can be logically combined with other condition
functions.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">keep_rows</span><span class="op">(</span><span class="va">row_condition</span><span class="op">)</span>

<span class="fu">keep_content_rows</span><span class="op">(</span><span class="va">content_row_condition</span><span class="op">)</span>

<span class="fu">has_count_in_cols</span><span class="op">(</span><span class="va">atleast</span>, <span class="va">...</span><span class="op">)</span>

<span class="fu">has_count_in_any_col</span><span class="op">(</span><span class="va">atleast</span>, <span class="va">...</span><span class="op">)</span>

<span class="fu">has_fraction_in_cols</span><span class="op">(</span><span class="va">atleast</span>, <span class="va">...</span><span class="op">)</span>

<span class="fu">has_fraction_in_any_col</span><span class="op">(</span><span class="va">atleast</span>, <span class="va">...</span><span class="op">)</span>

<span class="fu">has_fractions_difference</span><span class="op">(</span><span class="va">atleast</span>, <span class="va">...</span><span class="op">)</span>

<span class="fu">has_counts_difference</span><span class="op">(</span><span class="va">atleast</span>, <span class="va">...</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>row_condition</dt>
<dd><p>(<code>CombinationFunction</code>)<br> condition function which works on individual
analysis rows and flags whether these should be kept in the pruned table.</p></dd>
<dt>content_row_condition</dt>
<dd><p>(<code>CombinationFunction</code>)<br> condition function which works on individual
first content rows of leaf tables and flags whether these leaf tables should be kept in the pruned table.</p></dd>
<dt>atleast</dt>
<dd><p>(<code>count</code> or <code>proportion</code>)<br> threshold which should be met in order to
keep the row.</p></dd>
<dt>...</dt>
<dd><p>arguments for row or column access, see <a href="rtables_access.html">rtables_access</a>: either
<code>col_names</code> (<code>character</code>) including the names of the columns which should be used,
or alternatively <code>col_indices</code> (<code>integer</code>) giving the indices directly instead.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p><code>keep_rows()</code> returns a pruning function that can be used with <code><a href="https://roche.github.io/rtables/reference/prune_table.html" class="external-link">rtables::prune_table()</a></code>on <code>[rtables::TableTree()]</code> objects.
<code>keep_content_rows()</code> also returns a pruning function, the difference is that it
checks the condition on the first content row of leaf tables in the table.
<code>has_count_in_cols()</code> returns a condition function that sums the counts in the specified
column.
<code>has_count_in_any_col()</code> returns a condition function that compares the counts in the
specified columns with the threshold.
<code>has_fraction_in_cols()</code> returns a condition function that sums the counts in the
specified column, and computes the fraction by dividing by the total column counts.
<code>has_fraction_in_cols()</code> returns a condition function that looks at the fractions
in the specified columns and checks whether any of them fulfill the threshold.
<code>has_fractions_difference()</code> returns a condition function that extracts the fractions of each
specified column, and computes the difference of the minimum and maximum.
<code>has_counts_difference()</code> returns a condition function that extracts the counts of each
specified column, and computes the difference of the minimum and maximum.</p>
    </div>
    <div id="functions">
    <h2>Functions</h2>
    
<ul><li><p><code>keep_rows</code>: constructor for creating pruning functions based on
a row condition function. This removes all analysis rows (<code>TableRow</code>) that should be
pruned, i.e., don't fulfill the row condition. It removes the sub tree if there are no
children left.</p></li>
<li><p><code>keep_content_rows</code>: constructor for creating pruning functions based on
a condition for the (first) content row in leaf tables. This removes all leaf tables where
the first content row does not fulfill the condition. It does not check individual rows.
It then proceeds recursively by removing the sub tree if there are no children left.</p></li>
<li><p><code>has_count_in_cols</code>: constructor for creating condition functions on total counts in
the specified columns.</p></li>
<li><p><code>has_count_in_any_col</code>: constructor for creating condition functions on any of the counts in
the specified columns satisfying a threshold.</p></li>
<li><p><code>has_fraction_in_cols</code>: constructor for creating condition functions on total fraction in
the specified columns.</p></li>
<li><p><code>has_fraction_in_any_col</code>: constructor for creating condition functions on any fraction in
the specified columns.</p></li>
<li><p><code>has_fractions_difference</code>: constructor for creating condition function that checks the difference
between the fractions reported in each specified column.</p></li>
<li><p><code>has_counts_difference</code>: constructor for creating condition function that checks the difference
between the counts reported in each specified column.</p></li>
</ul></div>
    <div id="note">
    <h2>Note</h2>
    <p>Since most table specifications are worded positively, we name our constructor and condition
functions positively, too. However, note that the result of <code>keep_rows()</code> says what
should be pruned though, to conform with the <code><a href="https://roche.github.io/rtables/reference/prune_table.html" class="external-link">rtables::prune_table()</a></code> interface.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://roche.github.io/rtables/reference/basic_table.html" class="external-link">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="https://roche.github.io/rtables/reference/split_cols_by.html" class="external-link">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="https://roche.github.io/rtables/reference/split_rows_by.html" class="external-link">split_rows_by</a></span><span class="op">(</span><span class="st">"RACE"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="https://roche.github.io/rtables/reference/split_rows_by.html" class="external-link">split_rows_by</a></span><span class="op">(</span><span class="st">"STRATA1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="https://roche.github.io/rtables/reference/summarize_row_groups.html" class="external-link">summarize_row_groups</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="summarize_variables.html">summarize_vars</a></span><span class="op">(</span><span class="st">"COUNTRY"</span>, .stats <span class="op">=</span> <span class="st">"count_fraction"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="https://roche.github.io/rtables/reference/build_table.html" class="external-link">build_table</a></span><span class="op">(</span><span class="va">DM</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="co"># `keep_rows`</span></span>
<span class="r-in"><span class="va">is_non_empty</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="fu"><a href="combination_function.html">CombinationFunction</a></span><span class="op">(</span><span class="va">all_zero_or_na</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://roche.github.io/rtables/reference/prune_table.html" class="external-link">prune_table</a></span><span class="op">(</span><span class="va">tab</span>, <span class="fu">keep_rows</span><span class="op">(</span><span class="va">is_non_empty</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="co"># `keep_content_rows`</span></span>
<span class="r-in"><span class="va">more_than_twenty</span> <span class="op">&lt;-</span> <span class="fu">has_count_in_cols</span><span class="op">(</span>atleast <span class="op">=</span> <span class="fl">20L</span>, col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://roche.github.io/rtables/reference/prune_table.html" class="external-link">prune_table</a></span><span class="op">(</span><span class="va">tab</span>, <span class="fu">keep_content_rows</span><span class="op">(</span><span class="va">more_than_twenty</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="co"># `has_count_in_cols`</span></span>
<span class="r-in"><span class="va">more_than_one</span> <span class="op">&lt;-</span> <span class="fu">has_count_in_cols</span><span class="op">(</span>atleast <span class="op">=</span> <span class="fl">1L</span>, col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://roche.github.io/rtables/reference/prune_table.html" class="external-link">prune_table</a></span><span class="op">(</span><span class="va">tab</span>, <span class="fu">keep_rows</span><span class="op">(</span><span class="va">more_than_one</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="co"># `has_count_in_any_col`</span></span>
<span class="r-in"><span class="va">any_more_than_one</span> <span class="op">&lt;-</span> <span class="fu">has_count_in_any_col</span><span class="op">(</span>atleast <span class="op">=</span> <span class="fl">1L</span>, col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://roche.github.io/rtables/reference/prune_table.html" class="external-link">prune_table</a></span><span class="op">(</span><span class="va">tab</span>, <span class="fu">keep_rows</span><span class="op">(</span><span class="va">any_more_than_one</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="co"># `has_fraction_in_cols`</span></span>
<span class="r-in"><span class="va">more_than_five_percent</span> <span class="op">&lt;-</span> <span class="fu">has_fraction_in_cols</span><span class="op">(</span>atleast <span class="op">=</span> <span class="fl">0.05</span>, col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://roche.github.io/rtables/reference/prune_table.html" class="external-link">prune_table</a></span><span class="op">(</span><span class="va">tab</span>, <span class="fu">keep_rows</span><span class="op">(</span><span class="va">more_than_five_percent</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="co"># `has_fraction_in_any_col`</span></span>
<span class="r-in"><span class="va">any_atleast_five_percent</span> <span class="op">&lt;-</span> <span class="fu">has_fraction_in_any_col</span><span class="op">(</span>atleast <span class="op">=</span> <span class="fl">0.05</span>, col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://roche.github.io/rtables/reference/prune_table.html" class="external-link">prune_table</a></span><span class="op">(</span><span class="va">tab</span>, <span class="fu">keep_rows</span><span class="op">(</span><span class="va">more_than_five_percent</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="co"># `has_fractions_difference`</span></span>
<span class="r-in"><span class="va">more_than_five_percent_diff</span> <span class="op">&lt;-</span> <span class="fu">has_fractions_difference</span><span class="op">(</span>atleast <span class="op">=</span> <span class="fl">0.05</span>, col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://roche.github.io/rtables/reference/prune_table.html" class="external-link">prune_table</a></span><span class="op">(</span><span class="va">tab</span>, <span class="fu">keep_rows</span><span class="op">(</span><span class="va">more_than_five_percent_diff</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="co"># `has_counts_difference`</span></span>
<span class="r-in"><span class="va">more_than_one_diff</span> <span class="op">&lt;-</span> <span class="fu">has_counts_difference</span><span class="op">(</span>atleast <span class="op">=</span> <span class="fl">1L</span>, col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://roche.github.io/rtables/reference/prune_table.html" class="external-link">prune_table</a></span><span class="op">(</span><span class="va">tab</span>, <span class="fu">keep_rows</span><span class="op">(</span><span class="va">more_than_one_diff</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by NEST, Roche, Saibah Chohan, Francois Collin, Nick Paszty, Ting Qi, Daniel Sabanes Bove, Jana Stoilova, Adrian Waddell, Heng Wang, Godwin Yung, Carreras Maximo, Zhao Rui, Wojciech Wojciak.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

