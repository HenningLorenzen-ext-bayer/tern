---
title: "Design for LBT06"
author: "Jana Stoilova"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 2
    theme: journal
    highlight: zenburn
vignette: >
  %\VignetteIndexEntry{Design of LBT06}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  dev = "svg"
)
```

## Configuration

```{r setup}
library(rtables)
library(tern)
library(assertthat)
library(dplyr)

packageVersion("tern")
packageVersion("rtables")
```

## Data for examples

```{r data, results = "asis", eval = TRUE}

df <- data.frame(
 USUBJID = as.character(c(1:6)),
 ANRIND = factor(c(rep("LOW", 4), "NORMAL", "HIGH")),
 BNRIND = factor(c("LOW", "NORMAL", "HIGH", NA, "LOW", "NORMAL"))
)
```

## Full LBT06 Example
```{r}

  library(random.cdisc.data)
  adsl <- radsl(cached = TRUE)
  adlb <- radlb(cached = TRUE)

  adlb <- adlb %>%
    dplyr::filter(PARAMCD == "ALT") %>%
    dplyr::filter(!(AVISIT %in% c("SCREENING", "BASELINE"))) %>%
    dplyr::mutate(AVISIT = droplevels(AVISIT))

  result <- basic_table() %>%
    split_cols_by("ARM") %>%
    add_colcounts() %>%
    split_rows_by("PARAM", split_fun = drop_split_levels) %>%
    split_rows_by("AVISIT", split_fun = drop_split_levels) %>%
    count_abnormal_by_baseline(
      "ANRIND",
      abnormal = c("Low" = "LOW", "High" = "HIGH")
    ) %>%
    build_table(adlb, col_counts = table(adsl$ARM))

  result
```
