<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>MMRM Analysis — fit_mmrm • tern</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="MMRM Analysis — fit_mmrm" />
<meta property="og:description" content="Does the MMRM analysis. Multiple other functions can be called on the result to produce
tables and graphs." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tern</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/introduction.html">Introduction to tern</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<!-- start_releases -->
<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
Other releases
<span class="caret"></span></a><ul class="dropdown-menu" role="menu">
   <li><a href="../../index.html">latest</a></li>
   <li><a href="../../v0.7.4/index.html">v0.7.4</a></li>
   <li><a href="../../v0.7.3/index.html">v0.7.3</a></li>
   <li><a href="../../v0.7.1/index.html">v0.7.1</a></li>
   <li><a href="../../v0.7.0/index.html">v0.7.0</a></li>
   <li><a href="../../v0.6.9/index.html">v0.6.9</a></li>
   <li><a href="../../v0.6.8/index.html">v0.6.8</a></li>
   <li><a href="../../v0.6.7/index.html">v0.6.7</a></li>
   <li><a href="../../v0.6.6/index.html">v0.6.6</a></li>
   <li><a href="../../v0.6.5/index.html">v0.6.5</a></li>
   <li><a href="../../v0.6.4/index.html">v0.6.4</a></li>
   <li><a href="../../v0.6.2/index.html">v0.6.2</a></li>
   <li><a href="../../v0.6.1/index.html">v0.6.1</a></li>
   <li><a href="../../v0.6.0/index.html">v0.6.0</a></li>
   <li><a href="../../v0.5.0/index.html">v0.5.0</a></li>
</ul></li>
<!-- end_releases -->
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.roche.com/NEST/tern">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>MMRM Analysis</h1>
    
    <div class="hidden name"><code>fit_mmrm.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Does the MMRM analysis. Multiple other functions can be called on the result to produce
tables and graphs.</p>
    </div>

    <pre class="usage"><span class='fu'>fit_mmrm</span>(
  <span class='kw'>vars</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>response</span> <span class='kw'>=</span> <span class='st'>"AVAL"</span>, <span class='kw'>covariates</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(), <span class='kw'>id</span> <span class='kw'>=</span> <span class='st'>"USUBJID"</span>, <span class='kw'>arm</span> <span class='kw'>=</span> <span class='st'>"ARM"</span>, <span class='kw'>visit</span> <span class='kw'>=</span>
    <span class='st'>"AVISIT"</span>),
  <span class='no'>data</span>,
  <span class='kw'>conf_level</span> <span class='kw'>=</span> <span class='fl'>0.95</span>,
  <span class='kw'>cor_struct</span> <span class='kw'>=</span> <span class='st'>"unstructured"</span>,
  <span class='kw'>weights_emmeans</span> <span class='kw'>=</span> <span class='st'>"proportional"</span>,
  <span class='kw'>optimizer</span> <span class='kw'>=</span> <span class='st'>"automatic"</span>,
  <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>vars</th>
      <td><p>(named <code>list</code> of <code>string</code> or <code>character</code>)<br /> specifying the variables in the MMRM.
The following elements need to be included as character vectors and match corresponding columns
in <code>data</code>:</p><dl'>
<dt>response</dt><dd><p>the response variable</p></dd>
<dt>covariates</dt><dd><p>the additional covariate terms (might also include interactions)</p></dd>
<dt>id</dt><dd><p>the subject ID variable</p></dd>
<dt>arm</dt><dd><p>the treatment group variable (factor)</p></dd>
<dt>visit</dt><dd><p>the visit variable (factor)</p></dd>

</dl><p>Note that the main effects and interaction of <code>arm</code> and <code>visit</code> are by default included in the model.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>a <code>data.frame</code> with all the variables specified in
<code>vars</code>. Records with missing values in any independent variables
will be excluded.</p></td>
    </tr>
    <tr>
      <th>conf_level</th>
      <td><p>(<code>proportion</code>)<br /> confidence level of the interval.</p></td>
    </tr>
    <tr>
      <th>cor_struct</th>
      <td><p>a string specifying the correlation structure, defaults to
<code>"unstructured"</code>. See the details.</p></td>
    </tr>
    <tr>
      <th>weights_emmeans</th>
      <td><p>argument from <code><a href='https://rdrr.io/pkg/emmeans/man/emmeans.html'>emmeans</a></code>, "proportional" by default.</p></td>
    </tr>
    <tr>
      <th>optimizer</th>
      <td><p>a string specifying the optimization algorithm which should be used. By default, "automatic"
will (if necessary) try all possible optimization algorithms and choose the best result. If another algorithm
is chosen and does not give a valid result, an error will occur.</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>flag that controls whether "automatic" optimizer search can use available free cores on the
machine (not default).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An <code>mmrm</code> object which is a list with MMRM results:</p><dl'>
<dt>fit</dt><dd><p>The <code>lmerModLmerTest</code> object which was fitted to the data. Note that the attribute <code>optimizer</code>
contains the finally used optimization algorithm, which can be useful for refitting the model later on.</p></dd>
<dt>cov_estimate</dt><dd><p>The matrix with the covariance matrix estimate.</p></dd>
<dt>diagnostics</dt><dd><p>A list with model diagnostic statistics (REML criterion, AIC, corrected AIC, BIC).</p></dd>
<dt>lsmeans</dt><dd><p>This is a list with data frames <code>estimates</code> and <code>contrasts</code>.</p></dd>
<dt>vars</dt><dd><p>The variable list.</p></dd>
<dt>labels</dt><dd><p>Corresponding list with variable labels extracted from <code>data</code>.</p></dd>
<dt>ref_level</dt><dd><p>The reference level for the arm variable, which is always the first level.</p></dd>
<dt>conf_level</dt><dd><p>The confidence level which was used to construct the confidence intervals.</p></dd>

</dl>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Only Satterthwaite adjusted degrees of freedom (d.f.) are supported, because they
match the results obtained in SAS (confirmed for unstructured and compound symmetry correlation structures).</p>
<p>For the correlation structure (<code>cor_struct</code>), the user can choose among the following options, sorted
in descending number of variance parameters:</p><dl'>
<dt>unstructured</dt><dd><p>Unstructured covariance matrix. This is the most flexible choice and default.
If there are <code>T</code> visits, then <code>T * (T+1) / 2</code> variance parameters are used.
Note: the current actual implementation uses one more variance parameter, which does not have any
effect of the results. Therefore we report here the actually relevant number of parameters.</p></dd>
<dt>random-quadratic</dt><dd><p>Random quadratic spline for the random effects of the time variable.
7 variance parameters are used.</p></dd>
<dt>random-slope</dt><dd><p>Random slope for the random effects of the time variable. 4 variance parameters are used.</p></dd>
<dt>compound-symmetry</dt><dd><p>Constant correlation between visits. 2 variance parameters are used.</p></dd>

</dl>

<p>For the <code>optimizer</code>, the user can choose among the following alternatives to the recommended "automatic":</p><dl'>
<dt>nloptwrap_neldermead</dt><dd><p>NLopt version of the Nelder-Mead algorithm (via package <code>nloptr</code>)</p></dd>
<dt>nloptwrap_bobyqa</dt><dd><p>NLopt version of the BOBYQA algorithm (via package <code>nloptr</code>)</p></dd>
<dt>bobyqa</dt><dd><p>BOBYQA algorithm (via package <code>minqa</code>)</p></dd>
<dt>nlminbwrap</dt><dd><p>nlminb algorithm (wrapper for <code><a href='https://rdrr.io/r/stats/nlminb.html'>nlminb</a>)</code></p></dd>
<dt>neldermead</dt><dd><p>lme4 version of the Nelder-Mead algorithm with box constraints (via package <code>lme4</code>)</p></dd>
<dt>nmkbw</dt><dd><p>Nelder-Mead algorithm (via package <code>dfoptim</code>)</p></dd>
<dt>optimx_lbfgsb</dt><dd><p>L-BFGS-B algorithm (via package <code>optimx</code>)</p></dd>

</dl>

    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>The ordering of the input data sets can lead to slightly different numerical results or
different convergence behavior. This is a known observation with the used package
<code>lme4</code>. However, once convergence is achieved, the results are reliable up to
numerical precision.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>scda</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>dplyr</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>rtables</span>)

<span class='no'>adsl</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scda/man/synthetic_cdisc_data.html'>synthetic_cdisc_data</a></span>(<span class='st'>"latest"</span>)$<span class='no'>adsl</span>
<span class='no'>adqs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scda/man/synthetic_cdisc_data.html'>synthetic_cdisc_data</a></span>(<span class='st'>"latest"</span>)$<span class='no'>adqs</span>
<span class='no'>adqs_f</span> <span class='kw'>&lt;-</span> <span class='no'>adqs</span> <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span>(<span class='no'>PARAMCD</span> <span class='kw'>==</span> <span class='st'>"FKSI-FWB"</span> <span class='kw'>&amp;</span> !<span class='no'>AVISIT</span> <span class='kw'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"BASELINE"</span>)) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/base/droplevels.html'>droplevels</a></span>() <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span>(<span class='kw'>ARMCD</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span>(<span class='no'>ARMCD</span>, <span class='kw'>levels</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"ARM B"</span>, <span class='st'>"ARM A"</span>, <span class='st'>"ARM C"</span>))) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span>(
    <span class='kw'>AVISITN</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rank.html'>rank</a></span>(<span class='no'>AVISITN</span>) <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span>() <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>() <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span>()
  )
<span class='fu'><a href='https://rdrr.io/pkg/rtables/man/var_labels.html'>var_labels</a></span>(<span class='no'>adqs_f</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/rtables/man/var_labels.html'>var_labels</a></span>(<span class='no'>adqs</span>)

<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'># sometimes results in failure to converge with 1 negative eigenvalue</span>
<span class='no'>mmrm_results</span> <span class='kw'>&lt;-</span> <span class='fu'>fit_mmrm</span>(
  <span class='kw'>vars</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
    <span class='kw'>response</span> <span class='kw'>=</span> <span class='st'>"AVAL"</span>,
    <span class='kw'>covariates</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"STRATA1"</span>, <span class='st'>"BMRKR2"</span>),
    <span class='kw'>id</span> <span class='kw'>=</span> <span class='st'>"USUBJID"</span>,
    <span class='kw'>arm</span> <span class='kw'>=</span> <span class='st'>"ARMCD"</span>,
    <span class='kw'>visit</span> <span class='kw'>=</span> <span class='st'>"AVISIT"</span>
  ),
  <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>adqs_f</span>,
  <span class='kw'>cor_struct</span> <span class='kw'>=</span> <span class='st'>"unstructured"</span>,
  <span class='kw'>weights_emmeans</span> <span class='kw'>=</span> <span class='st'>"equal"</span>,
  <span class='kw'>optimizer</span> <span class='kw'>=</span> <span class='st'>"nloptwrap_neldermead"</span>  <span class='co'># Only to speed up this example.</span>
)
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by NEST, Roche, Saibah Chohan, Francois Collin, Nick Paszty, Ting Qi, Daniel Sabanes Bove, Jana Stoilova, Adrian Waddell, Heng Wang, Godwin Yung, Carreras Maximo, Zhao Rui, Wojciech Wojciak.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


