% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/t_events_term_id.R
\name{t_events_per_term_id}
\alias{t_events_per_term_id}
\title{Basic Events Table}
\usage{
t_events_per_term_id(
  terms,
  id,
  col_by,
  col_N = NULL,
  total = NULL,
  event_type = "event",
  table_tree = FALSE
)
}
\arguments{
\item{terms}{character or factor vector, or \code{data.frame} to represent events information; Currently \code{terms}
can only be a vector or dataframe with 1 or 2 columns. For \code{terms} with 2 columns, 1st column should represent
higher level term and 2nd column should be lower level term. \code{var_relabel} is used as the character string
used as a label in the column header for each term.}

\item{id}{vector of subject identifier. Length of \code{id} must be the same as the length or number of rows of
\code{terms}.}

\item{col_by}{logical factor or data.frame with reference and comparison group information, the
first \code{level} indicates the reference group. See the functions \code{factor_to_matrix_by}
and \code{add_total_by}.}

\item{col_N}{numeric vector with information of the number of patients in the levels of \code{col_by}. This is useful
if there are patients that have no adverse events can be accounted for with this argument.}

\item{total}{string of column name of an added total column using \code{\link[rtables]{by_add_total}} to
\code{col_by} and \code{\link{col_N_add_total}} to \code{col_N}. If \code{NULL} no total column is added.}

\item{event_type}{type of event that is summarized (e.g. adverse event, treatment). Default is "event".}

\item{table_tree}{logical, if \code{FALSE} then a single \code{rtable} gets returned, if \code{TRUE} a
\code{\link{node}} object gets returned with the elementary \code{rtable} objects.}
}
\value{
an \code{\link{rtable}} object.
}
\description{
This function summarizes number of unique subjects with events and total number of events.
It creates basic summary of events and can be used for any events data like Adverse Events,
concomitant medication, medical history, etc.
}
\details{
Implementation examples are to apply \code{t_events_per_term_id} on Adverse Event data
to create Adverse Events summary table
(\code{AET02},
\href{http://bioportal.roche.com/stream_doc/2_05/um/report_outputs_aet02.html#example-report-outputs-aet02-aet02}{
STREAM2.x},
\href{https://rochewiki.roche.com/confluence/pages/viewpage.action?pageId=294027342}{STREAM1.17} ),
or apply on Concomitant Medication data to create Concomitant Treatment summary table
(\code{CMT01},
\href{http://bioportal.roche.com/stream_doc/2_05/um/report_outputs_cmt01.html#example-report-outputs-cmt01-cmt01}{
STREAM2.x},
\href{https://rochewiki.roche.com/confluence/pages/viewpage.action?pageId=294027342}{STREAM1.17}).


\code{t_events_per_term_id} includes percentages based on the total number of subjects
in the column heading (i.e. \code{"N=nnn"}). \code{col_N} can be explicitly specified to
get N for percentage calculation from either events dataset or additional dataset such as
subject level dataset. See the example.

Multiple events within a subject of the same term (if \code{terms} is one level) or lower level term
(if \code{terms} is two levels) are counted once when counting number of subjects.

\code{t_events_per_term_id} doesn't deal with data with any non-complete records (has \code{NA}),
e.g. if any terms are missing. Impute missing values before using \code{t_events_per_term_id}.

\code{t_events_per_term_id} orders data by "All Patients" column from the most commonly
 reported higher level term to the least frequent one. Within each group of higher level term,
 it sorts by decreasing frequency of lower level term. It brakes ties using \code{terms} names in
 alphabetical order.

\if{html}{

The data is split and table functions are applied to leaf nodes as follows:

\figure{lt_events_per_term_id_2.png}{options: alt="lt_events_per_term_id_2 layout"}
}
}
\examples{

library(dplyr)
library(purrr)

t_events_per_term_id(
 terms = with_label(factor(c("t1", "t1", "t2", "t2", "t2")), "Term"),
 id = c(1, 4, 2, 3, 3),
 col_by = factor(c("A", "A", "B", "C", "C")),
 col_N = c(2, 4, 10),
 total = "All Patients"
)

\dontrun{
# terms can't be empty strings or NA
t_events_per_term_id(
 terms = with_label(factor(c("", "t1", "t2", "t2", "t2")), "Term"),
 id = c(1, 4, 2, 3, 3),
 col_by = factor(c("A", "A", "B", "C", "C")),
 col_N = c(2, 4, 10),
 total = "All Patients"
)

t_events_per_term_id(
 terms = with_label(factor(c(NA, "t1", "t2", "t2", "t2")), "Term"),
 id = c(1, 4, 2, 3, 3),
 col_by = factor(c("A", "A", "B", "C", "C")),
 col_N = c(2, 4, 10),
 total = "All Patients"
)

}

t_events_per_term_id(
 terms = explicit_na(sas_na(factor(c("", "", "t2", "t1", "t2")))),
 id = c(1, 4, 2, 3, 3),
 col_by = factor(c("A", "A", "B", "C", "C")),
 col_N = c(2, 4, 10),
 total = "All Patients"
)

t_events_per_term_id(
 terms = with_label(factor(c("t1", "t1", "t2", "t2", "t2")), "Term"),
 id = c(1, 4, 2, 3, 3),
 col_by = factor(c("A", "A", "B", "C", "C")),
 col_N = c(2, 4, 10)
)


library(random.cdisc.data)

ADSL <- radsl(10, seed = 1)
ADAE <- radae(ADSL, 4L, seed = 2)

t_events_per_term_id(
  terms = ADAE$AEDECOD,
  id = ADAE$USUBJID,
  col_by = ADAE$ARM,
  col_N = table(ADSL$ARM),
  event_type = "adverse event"
)

t_events_per_term_id(
  terms = ADAE$AEDECOD,
  id = ADAE$USUBJID,
  col_by = ADAE$ARM,
  total = "All Patients",
  col_N = table(ADSL$ARM),
  event_type = "adverse event"
)

t_events_per_term_id(
  terms = ADAE[, c("AEBODSYS", "AEDECOD")],
  id = ADAE$USUBJID,
  col_by = ADAE$ARM,
  col_N = table(ADSL$ARM),
  total = "All Patients"
)

ADSL <- cadsl
ADCM <- cadcm
ADCM <- ADCM \%>\%
  dplyr::filter(ATIREL == "CONCOMITANT")

t_events_per_term_id(
  terms = ADCM[, c("CMCLAS", "CMDECOD")],
  id = ADCM$USUBJID,
  col_by = ADCM$ARM,
  col_N = table(ADSL$ARM),
  total = "All Patients",
  event_type = "treatment"
)


# Table Tree

summary(t_events_per_term_id(
  terms = ADAE$AEDECOD,
  id = ADAE$USUBJID,
  col_by = ADAE$ARM,
  col_N = table(ADSL$ARM),
  total = "All Patients",
  table_tree = TRUE
))


tbls <- t_events_per_term_id(
 terms = with_label(factor(c("t1", "t1", "t2", "t2", "t2")), "Term"),
 id = c(1, 4, 2, 3, 3),
 col_by = factor(c("A", "A", "B", "C", "C")),
 col_N = c(2, 4, 10),
 table_tree = TRUE
)
summary(tbls)


tbls <- t_events_per_term_id(
  terms = ADAE[, c("AEBODSYS", "AEDECOD")],
  id = ADAE$USUBJID,
  col_by = ADAE$ARM,
  col_N = table(ADSL$ARM),
  total = "All Patients",
  table_tree = TRUE
)
summary(tbls)
tbls[[1]]
tbls[['cl A']]


}
\seealso{
\code{\link{t_count_unique}}, \code{\link{t_el_events_per_term_id}},
  \code{\link{t_events_per_term_grade_id}}
}
\author{
Adrian Waddell (waddella) \email{adrian.waddell@roche.com}

Carolyn Zhang (zhanc107) \email{carolyn.zhang@duke.edu}

Heng Wang (wangh107) \email{wang.heng@gene.com}

Ting Qi (qit3) \email{qit3@gene.com}
}
